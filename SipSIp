<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIP SIP STORE | Final Official</title>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --red: #D32F2F; --yellow: #FFC107; --dark: #1a1a1a; --white: #ffffff; --bg: #FFF9E6; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--dark); overflow-x: hidden; }
        
        /* Navbar */
        nav { background: var(--red); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .logo-img { height: 45px; border-radius: 8px; background: #fff; padding: 3px; border: 2px solid var(--yellow); }
        .brand-text { color: var(--yellow); font-weight: 800; font-size: 1.3rem; margin-left: 10px; }

        /* Slider */
        .slider-box { width: 100%; height: 230px; background: #000; position: relative; overflow: hidden; border-bottom: 5px solid var(--yellow); }
        @media(min-width: 768px) { .slider-box { height: 450px; } }
        .slide { width: 100%; height: 100%; object-fit: contain; position: absolute; opacity: 0; transition: opacity 0.8s; }
        .slide.active { opacity: 1; }

        /* Main Layout */
        .container { max-width: 1100px; margin: 25px auto; padding: 0 15px; }
        .card { background: var(--white); padding: 25px; border-radius: 25px; box-shadow: 0 6px 30px rgba(0,0,0,0.07); margin-bottom: 25px; border: 1px solid #eee; }

        .addr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .full { grid-column: span 2; }
        input { width: 100%; padding: 14px; border: 1.5px solid #ddd; border-radius: 12px; font-size: 1rem; outline: none; }
        
        .btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .btn-red { background: var(--red); color: white; }
        .btn-wa { background: #25D366; color: white; display: flex; align-items: center; justify-content: center; gap: 12px; text-decoration: none; margin-top: 20px; }
        
        .addr-card { border: 2.5px solid #eee; padding: 18px; border-radius: 15px; margin-bottom: 12px; cursor: pointer; background: #fafafa; position: relative; }
        .addr-card.selected { border-color: var(--red); background: #fff8f8; border-width: 3px; }
        .addr-card.selected::after { content: 'SELECTED'; position: absolute; right: 15px; top: 15px; font-size: 0.6rem; color: var(--red); font-weight: 900; }

        .hidden { display: none; }
        .flex-layout { display: flex; flex-direction: column; gap: 20px; }
        @media(min-width: 768px) { .flex-layout { flex-direction: row; } .flex-layout > div { flex: 1; } }
        
        footer { background: var(--dark); color: #999; padding: 40px 20px; text-align: center; font-size: 0.8rem; }
    </style>
</head>
<body>

<nav>
    <div style="display:flex; align-items:center;">
        <img src="https://image2url.com/r2/default/images/1770388870656-bd201fc8-9ec7-41fa-8617-cdfa8d0a3a28.webp" class="logo-img">
        <span class="brand-text">SIP SIP STORE</span>
    </div>
    <div id="auth-status" style="color:white; font-size:0.75rem; font-weight:600;">Guest Access</div>
</nav>

<div id="hero-slider" class="slider-box hidden">
    <img src="https://image2url.com/r2/default/images/1770389011543-1bbce6f4-410f-4650-b1a5-21ffc6ea7ade.jpeg" class="slide active">
    <img src="https://image2url.com/r2/default/images/1770389058796-fe852d38-1390-4e74-bfd5-be2a0956662f.jpeg" class="slide">
    <img src="https://image2url.com/r2/default/images/1770389081280-318dfdbd-802b-4720-ba69-183e30bfc02a.jpeg" class="slide">
    <img src="https://image2url.com/r2/default/images/1770389175316-30f095b7-e2f6-4c76-ab39-f426ea366eb0.jpeg" class="slide">
</div>

<div class="container">
    <div id="auth-view" class="card" style="max-width:450px; margin: 40px auto; text-align:center;">
        <h2 style="color:var(--red); margin-bottom:20px;">Wholesale Portal</h2>
        
        <div id="g_id_onload"
             data-client_id="AIzaSyC-KoUesAIMNO2xQwGC0hQNbrGMWEbfHJc"
             data-callback="handleCredentialResponse">
        </div>
        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="signin_with" data-shape="pill" data-logo_alignment="left"></div>

        <div style="margin:40px 0; border-top:1px solid #eee; position:relative;">
            <span style="position:absolute; top:-11px; left:33%; background:#fff; padding:0 15px; font-size:0.75rem; color:#aaa; font-weight:600;">ADMIN LOGIN</span>
        </div>
        <input type="text" id="admin-user" placeholder="Admin ID">
        <input type="password" id="admin-pass" placeholder="Password" style="margin-top:10px;">
        <button class="btn btn-red" style="background:var(--dark); margin-top:15px;" onclick="initAdminLogin()">Access Admin Panel</button>
    </div>

    <div id="app-view" class="hidden">
        <div class="flex-layout">
            <div id="customer-section">
                <div class="card" style="text-align:center;">
                    <img src="https://image2url.com/r2/default/images/1770389323225-eb3a68d1-f98b-4c05-8c99-677d4752d7ed.png" width="200">
                    <h2 style="color:var(--red); margin:10px 0;">Premium Soupy Noodle</h2>
                    
                    <div style="text-align:left; margin-top:25px;">
                        <label style="font-size:0.8rem; font-weight:600;">Delivery Address (Amazon Style)</label>
                        <div id="address-container"></div>
                        <button onclick="toggleAddressForm()" style="color:var(--red); background:none; border:none; font-weight:800; cursor:pointer; font-size:0.8rem; padding:10px 0;">+ Add New Shop Address</button>
                        
                        <div id="address-form" class="hidden" style="background:#fcfcfc; padding:20px; border-radius:20px; border:1px dashed #ccc;">
                            <div class="addr-grid">
                                <div class="full"><input type="text" id="addr-name" placeholder="Business Name"></div>
                                <div><input type="text" id="addr-shop" placeholder="Shop No."></div>
                                <div><input type="text" id="addr-area" placeholder="Area/Street"></div>
                                <div><input type="text" id="addr-city" placeholder="City"></div>
                                <div><input type="number" id="addr-pin" placeholder="Pincode"></div>
                            </div>
                            <button class="btn btn-red" style="margin-top:15px; padding:12px; font-size:0.8rem;" onclick="handleSaveAddress()">Save This Address</button>
                        </div>

                        <div style="margin-top:25px;">
                            <label style="font-size:0.8rem; font-weight:600;">Total Packs (Min 50)</label>
                            <input type="number" id="order-qty" value="50" min="50" style="font-size:1.8rem; font-weight:800; text-align:center; color:var(--red);" oninput="calcTotal()">
                        </div>
                    </div>

                    <div style="background:var(--dark); color:var(--yellow); padding:20px; border-radius:15px; margin-top:25px;">
                        <span style="font-size:0.8rem; opacity:0.8;">Grand Total</span>
                        <h1 id="total-display" style="margin:0; font-size:2.5rem;">₹500</h1>
                    </div>
                    
                    <button class="btn btn-wa" onclick="handleWhatsAppOrder()">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="26"> SEND ORDER TO FACTORY
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 id="history-title" style="margin-top:0;">Order Activity</h3>
                <div id="history-list"></div>
                <button class="btn" style="background:#f5f5f5; font-size:0.8rem; margin-top:40px; color:#666;" onclick="location.reload()">Log Out</button>
            </div>
        </div>
    </div>
</div>

<footer>
    <b>SIP SIP STORE | URBAN FOODS</b><br>Agroha, Hisar (Haryana)
</footer>

<script>
    let sipDB = JSON.parse(localStorage.getItem('sipsip_official_v1')) || { accounts: {}, globalOrders: [] };
    let currentUser = null; let isFactoryAdmin = false; let selectedAddrIdx = -1;

    // --- GOOGLE LOGIN (REAL API) ---
    function handleCredentialResponse(response) {
        const payload = parseJwt(response.credential);
        currentUser = payload.email;
        isFactoryAdmin = false;
        launch();
    }

    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(window.atob(base64));
    }

    // --- ADMIN LOGIN (SECURE) ---
    function initAdminLogin() {
        const u = document.getElementById('admin-user').value;
        const p = document.getElementById('admin-pass').value;
        if(u === "SIPSIPADMIN" && p === "SIPSIPADMIN") {
            currentUser = "FACTORY_ADMIN"; isFactoryAdmin = true; launch();
        } else { alert("❌ Unauthorized Admin Login Attempt!"); }
    }

    function launch() {
        document.getElementById('auth-view').classList.add('hidden');
        document.getElementById('app-view').classList.remove('hidden');
        document.getElementById('hero-slider').classList.remove('hidden');
        document.getElementById('auth-status').innerText = isFactoryAdmin ? "MODE: ADMIN" : "LOGGED: " + currentUser;
        if(isFactoryAdmin) {
            document.getElementById('customer-section').classList.add('hidden');
            document.getElementById('history-title').innerText = "Global Order Log (Factory)";
        }
        runSlider(); refreshAddresses(); refreshHistory();
    }

    function runSlider() {
        let i = 0; const s = document.querySelectorAll('.slide');
        setInterval(() => { s[i].classList.remove('active'); i = (i+1)%s.length; s[i].classList.add('active'); }, 4000);
    }

    function toggleAddressForm() { document.getElementById('address-form').classList.toggle('hidden'); }

    function handleSaveAddress() {
        const n = document.getElementById('addr-name').value;
        const sh = document.getElementById('addr-shop').value;
        const ar = document.getElementById('addr-area').value;
        const ci = document.getElementById('addr-city').value;
        const pi = document.getElementById('addr-pin').value;
        if(!n || !ci || !pi) return alert("Bhai, shop name aur city zaroori hai!");
        if(!sipDB.accounts[currentUser]) sipDB.accounts[currentUser] = { addresses: [] };
        sipDB.accounts[currentUser].addresses.push({ store: n, full: `${sh}, ${ar}, ${ci} - ${pi}` });
        commit(); refreshAddresses(); toggleAddressForm();
    }

    function refreshAddresses() {
        if(isFactoryAdmin) return;
        const box = document.getElementById('address-container');
        const acc = sipDB.accounts[currentUser];
        if(!acc || acc.addresses.length === 0) return box.innerHTML = "<small style='color:#999;'>No addresses found.</small>";
        box.innerHTML = acc.addresses.map((a, i) => `
            <div class="addr-card ${selectedAddrIdx===i?'selected':''}" onclick="selectedAddrIdx=${i}; refreshAddresses();">
                <b>${a.store}</b><br><small>${a.full}</small>
            </div>
        `).join('');
    }

    function calcTotal() { document.getElementById('total-display').innerText = "₹" + (document.getElementById('order-qty').value * 10); }

    function handleWhatsAppOrder() {
        if(selectedAddrIdx === -1) return alert("❌ Pehle address select karo!");
        const qty = document.getElementById('order-qty').value;
        const addr = sipDB.accounts[currentUser].addresses[selectedAddrIdx];
        const oid = "SIP" + Date.now().toString().slice(-6);
        
        sipDB.globalOrders.push({ id: oid, owner: currentUser, store: addr.store, address: addr.full, quantity: qty, bill: qty*10, date: new Date().toLocaleDateString(), status: 'Pending' });
        commit(); refreshHistory();
        
        const text = `*NEW ORDER - SIP SIP STORE*%0A` +
                     `--------------------------------%0A` +
                     `*Order ID:* #${oid}%0A` +
                     `*Item:* Premium Soupy Noodle%0A` +
                     `*Quantity:* ${qty} Pkts%0A` +
                     `*Total Bill:* ₹${qty*10}%0A` +
                     `--------------------------------%0A` +
                     `*DELIVER TO:*%0A` +
                     `*Store:* ${addr.store}%0A` +
                     `*Address:* ${addr.full}%0A` +
                     `--------------------------------%0A` +
                     `_Urban Foods Distribution_`;
        
        window.open(`https://wa.me/917014258374?text=${text}`);
    }

    function refreshHistory() {
        const box = document.getElementById('history-list');
        let data = isFactoryAdmin ? sipDB.globalOrders : sipDB.globalOrders.filter(o => o.owner === currentUser);
        if(data.length === 0) return box.innerHTML = "<small>No orders yet.</small>";
        box.innerHTML = data.slice().reverse().map(o => `
            <div style="border-bottom:1px solid #f5f5f5; padding:15px 0; display:flex; justify-content:space-between; align-items:center;">
                <div><b>#${o.id}</b> | ₹${o.bill}<br><small style="color:#666;">${o.store}</small></div>
                <div><span style="font-size:0.7rem; font-weight:800; color:var(--red);">${o.status}</span></div>
            </div>
        `).join('');
    }

    function commit() { localStorage.setItem('sipsip_official_v1', JSON.stringify(sipDB)); }
</script>
</body>
</html>
